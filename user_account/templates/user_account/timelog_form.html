{% extends 'base.html' %}
{% block content %}
<div class="min-h-screen bg-gray-50 flex justify-center pt-8 px-4">
  <div class="w-full max-w-3xl">
    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-8">

      <!-- Assigned Tasks -->
      <h2 class="flex items-center justify-center gap-2 text-2xl font-bold text-gray-800 mb-6">
        <i data-lucide="clipboard-list" class="w-6 h-6 text-blue-600"></i>
        Assigned Tasks
      </h2>
      {% if assigned_work_items %}
        <ul class="space-y-4">
          {% for item in assigned_work_items %}
            <li class="flex justify-between items-center bg-gray-50 hover:bg-gray-100 rounded-xl p-4 shadow-sm border border-gray-200">
              <div>
                <p class="text-gray-700 font-medium">{{ item.work_type.name }}</p>
              </div>

              <!-- Time In button always shown -->
              {% if active_logs %}
                <!-- Trigger modal if there is an active task -->
                <button type="button"
                  onclick="openModal('{{ item.work_type.name }}')"
                  class="flex items-center gap-2 px-4 py-2 bg-gray-400 text-white text-sm font-semibold rounded-lg shadow-md cursor-not-allowed">
                  <i data-lucide="log-in" class="w-4 h-4"></i>
                  Time In
                </button>
              {% else %}
                <!-- Normal Time In -->
                <form method="post" action="{% url 'timelog_timein' item.task.id item.work_type.id %}">
                  {% csrf_token %}
                  <button type="submit"
                    class="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold rounded-lg shadow-md transition cursor-pointer">
                    <i data-lucide="log-in" class="w-4 h-4"></i>
                    Time In
                  </button>
                </form>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="text-center py-8 text-gray-500">
          <p class="italic">No tasks assigned right now.</p>
        </div>
      {% endif %}

      <!-- Active Tasks -->
      {% if active_logs %}
        <h2 class="flex items-center justify-center gap-2 text-2xl font-bold text-gray-800 mt-8 mb-6">
          <i data-lucide="timer" class="w-6 h-6 text-yellow-600"></i>
          Active Tasks
        </h2>
        <ul class="space-y-4">
          {% for log in active_logs %}
            <li class="flex justify-between items-center bg-gray-50 hover:bg-gray-100 rounded-xl p-4 shadow-sm border border-gray-200">
              <div>
                <p class="text-gray-700 font-medium">{{ log.work_type.name }}</p>
              </div>
              <form method="post" action="{% url 'timelog_timeout' log.id %}">
                {% csrf_token %}
                <button type="submit"
                  class="flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-semibold rounded-lg shadow-md transition cursor-pointer">
                  <i data-lucide="log-out" class="w-4 h-4"></i>
                  Time Out
                </button>
              </form>
            </li>
          {% endfor %}
        </ul>
      {% endif %}

    </div>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center hidden z-50">
  <div class="bg-white p-6 rounded-xl shadow-lg max-w-sm text-center">
    <div class="flex items-center justify-center gap-2 mb-3">
      <i data-lucide="alert-triangle" class="w-6 h-6 text-yellow-600"></i>
      <h3 class="text-lg font-bold text-gray-800">Active Task</h3>
    </div>
    <p class="text-gray-600 mb-4">
      You must finish your active task before starting <span id="modal-task"></span>.
    </p>
    <button onclick="closeModal()" class="flex items-center gap-2 px-4 py-2 cursor-pointer bg-blue-600 hover:bg-blue-700 text-white rounded-lg mx-auto ">
      <i data-lucide="check" class="w-4 h-4"></i>
      Okay
    </button>
  </div>
</div>

<!-- Lucide Icons -->
<script src="https://unpkg.com/lucide@latest"></script>
<script>
  lucide.createIcons();

  function openModal(taskName) {
    document.getElementById('modal-task').textContent = taskName;
    document.getElementById('modal').classList.remove('hidden');
  }
  function closeModal() {
    document.getElementById('modal').classList.add('hidden');
  }
</script>
{% endblock %}
